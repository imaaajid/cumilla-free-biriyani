<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cumilla Biriyani Tracker | Developed by Abdur Rahman Majid</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Hind Siliguri', sans-serif; transition: background-color 0.3s; }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .dark .glass { background: rgba(31, 41, 55, 0.9); border-color: rgba(75, 85, 99, 0.3); }
        #preloader { position: fixed; inset: 0; background: white; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.5s; }
        .dark #preloader { background: #111827; }
        .stock-out { filter: grayscale(1); opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body class="bg-orange-50 dark:bg-gray-900 dark:text-gray-100 pb-40">

    <div id="preloader">
        <lottie-player src="https://assets2.lottiefiles.com/packages/lf20_m6cuL6.json" background="transparent" speed="1" style="width: 200px; height: 200px;" loop autoplay></lottie-player>
        <p class="text-orange-600 font-bold animate-pulse mt-4">‡¶¨‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶®‡¶ø ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>

    <div class="bg-stone-900 text-white py-3 px-4 flex justify-between items-center sticky top-0 z-[60] shadow-md">
        <div class="text-[12px] font-bold text-orange-400" id="countdown">‡¶á‡¶´‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ï‡¶ø: ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        <button onclick="toggleDarkMode()" class="p-2 bg-gray-800 rounded-lg text-orange-400"><i id="dark-icon" class="fa-solid fa-moon"></i></button>
    </div>

    <header class="bg-white/80 dark:bg-gray-800/80 border-b border-orange-100 dark:border-gray-700 py-6 px-4 text-center glass sticky top-[48px] z-50">
        <h1 class="text-2xl font-black text-orange-600 tracking-tighter">CUMILLA BIRIYANI üçñ</h1>
        <p class="text-[10px] font-bold opacity-60 uppercase tracking-widest mt-1">Real-time Free Food Tracker</p>
    </header>

    <main id="post-container" class="max-w-md mx-auto px-4 mt-8 space-y-6">
        </main>

    <footer class="max-w-md mx-auto px-4 py-10 text-center mb-20">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-[2.5rem] shadow-xl border border-orange-100 dark:border-gray-700">
            <p class="text-gray-500 dark:text-gray-400 text-[10px] font-bold uppercase tracking-[0.2em] mb-3">Developed & Designed By</p>
            <h2 class="text-2xl font-black text-gray-800 dark:text-white mb-4">Abdur Rahman Majid</h2>
            
            <div class="flex justify-center gap-3">
                <a href="https://facebook.com/imaaajid" target="_blank" class="w-11 h-11 bg-blue-600 text-white rounded-2xl flex items-center justify-center text-xl shadow-lg hover:scale-110 transition-transform"><i class="fa-brands fa-facebook-f"></i></a>
                <a href="https://facebook.com/imaaajid.2" target="_blank" class="w-11 h-11 bg-sky-500 text-white rounded-2xl flex items-center justify-center text-xl shadow-lg hover:scale-110 transition-transform"><i class="fa-brands fa-facebook"></i></a>
                <a href="https://instagram.com/imaaajid" target="_blank" class="w-11 h-11 bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-600 text-white rounded-2xl flex items-center justify-center text-xl shadow-lg hover:scale-110 transition-transform"><i class="fa-brands fa-instagram"></i></a>
            </div>
        </div>
    </footer>

    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 w-full max-w-md px-4 z-40">
        <button onclick="toggleForm()" class="w-full bg-orange-600 text-white font-black py-4 rounded-3xl shadow-2xl flex items-center justify-center gap-3 border-4 border-white dark:border-gray-800 active:scale-95 transition-all">
            <i class="fa-solid fa-plus-circle text-xl"></i> ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
        </button>
    </div>

    <div id="add-form" class="hidden fixed inset-0 bg-black/70 backdrop-blur-md flex items-end justify-center z-[100]">
        <div class="bg-white dark:bg-gray-800 w-full max-w-md p-8 rounded-t-[3rem] shadow-2xl">
            <h2 class="text-xl font-bold mb-6">‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶®‡¶ø ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü üìù</h2>
            <input id="loc-name" type="text" placeholder="‡¶è‡¶≤‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶∞‡¶æ‡¶ú‡¶ó‡¶û‡ßç‡¶ú ‡¶Æ‡ßã‡ßú)" class="w-full p-4 bg-gray-100 dark:bg-gray-700 rounded-2xl mb-3 outline-none dark:text-white border-none">
            <textarea id="loc-desc" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." class="w-full p-4 bg-gray-100 dark:bg-gray-700 rounded-2xl mb-6 outline-none h-24 dark:text-white border-none"></textarea>
            <div class="flex gap-4">
                <button onclick="toggleForm()" class="flex-1 font-bold text-gray-400">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                <button onclick="saveData()" id="submit-btn" class="flex-[2] bg-orange-600 text-white py-4 rounded-2xl font-black">‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>
    </div>

    <script>
        const DB_URL = "https://cumilla-biriyani-default-rtdb.asia-southeast1.firebasedatabase.app/posts.json";

        // 1. Countdown Fix (Cumilla Time)
        function updateCountdown() {
            const now = new Date();
            const iftar = new Date();
            iftar.setHours(18, 15, 0); 
            if (now > iftar) iftar.setDate(iftar.getDate() + 1);
            const diff = iftar - now;
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            document.getElementById('countdown').innerText = `‡¶á‡¶´‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ï‡¶ø: ${h}‡¶ò‡¶£‡ßç‡¶ü‡¶æ ${m}‡¶Æ‡¶ø. ${s}‡¶∏‡ßá.`;
        }
        setInterval(updateCountdown, 1000);

        // 2. Fetch & Vote Fix
        async function fetchData() {
            const res = await fetch(DB_URL);
            const data = await res.json();
            const container = document.getElementById('post-container');
            container.innerHTML = "";
            
            if(!data) {
                container.innerHTML = "<p class='text-center py-10 opacity-50'>‡¶Ü‡¶ú ‡¶ï‡ßã‡¶®‡ßã ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶®‡ßá‡¶á‡•§</p>";
                return;
            }

            Object.keys(data).reverse().forEach(id => {
                const post = data[id];
                if ((Date.now() - post.timestamp) > 86400000) return;
                const isStockOut = (post.stock_out || 0) >= 5;

                container.innerHTML += `
                    <div class="bg-white dark:bg-gray-800 rounded-[2rem] p-6 shadow-lg border border-orange-50 dark:border-gray-700 relative ${isStockOut ? 'stock-out' : ''}">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-[10px] font-bold text-gray-400 italic">${timeSince(post.timestamp)} ‡¶Ü‡¶ó‡ßá</span>
                            <button onclick="sharePost('${post.location}', '${post.description}')" class="text-orange-500"><i class="fa-solid fa-share-nodes"></i></button>
                        </div>
                        <h3 class="text-xl font-black mb-1">üìç ${post.location}</h3>
                        <p class="text-gray-500 dark:text-gray-400 text-sm mb-6">${post.description}</p>
                        
                        <div class="flex gap-3 mb-4">
                            <button onclick="handleVote('${id}', 'true')" class="flex-1 py-3 bg-green-50 dark:bg-green-900/20 text-green-600 rounded-xl text-xs font-black border border-green-100 dark:border-green-900">‚úÖ ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø (${post.true || 0})</button>
                            <button onclick="handleVote('${id}', 'fake')" class="flex-1 py-3 bg-red-50 dark:bg-red-900/20 text-red-600 rounded-xl text-xs font-black border border-red-100 dark:border-red-900">‚ùå ‡¶≠‡ßÅ‡ßü‡¶æ (${post.fake || 0})</button>
                        </div>
                        <button onclick="handleVote('${id}', 'stock_out')" class="w-full py-2 bg-gray-50 dark:bg-gray-700 rounded-lg text-[10px] font-bold text-gray-400 uppercase tracking-widest">‡¶¨‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∂‡ßá‡¶∑? ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                `;
            });
            setTimeout(() => { document.getElementById('preloader').style.display = 'none'; }, 2000);
        }

        async function handleVote(id, type) {
            const res = await fetch(`https://cumilla-biriyani-default-rtdb.asia-southeast1.firebasedatabase.app/posts/${id}.json`);
            const post = await res.json();
            const update = {};
            update[type] = (post[type] || 0) + 1;
            await fetch(`https://cumilla-biriyani-default-rtdb.asia-southeast1.firebasedatabase.app/posts/${id}.json`, {
                method: 'PATCH',
                body: JSON.stringify(update)
            });
            fetchData();
        }

        async function saveData() {
            const loc = document.getElementById('loc-name').value;
            const desc = document.getElementById('loc-desc').value;
            if(!loc || !desc) return alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®!");

            document.getElementById('submit-btn').innerText = "‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            await fetch(DB_URL, {
                method: 'POST',
                body: JSON.stringify({
                    location: loc, description: desc, timestamp: Date.now(), true: 0, fake: 0, stock_out: 0
                })
            });
            toggleForm();
            fetchData();
        }

        function sharePost(loc, desc) {
            const text = `üçñ *‡¶´‡ßç‡¶∞‡¶ø ‡¶¨‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶®‡¶ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü!*\nüìç ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®: ${loc}\nüìù ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§: ${desc}\n\n‡¶∏‡¶¨ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶ñ‡¶æ‡¶®‡ßá: ${window.location.href}`;
            window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`, '_blank');
        }

        function timeSince(d) {
            const s = Math.floor((Date.now() - d) / 1000);
            if (s / 3600 > 1) return Math.floor(s/3600) + " ‡¶ò‡¶£‡ßç‡¶ü‡¶æ";
            if (s / 60 > 1) return Math.floor(s/60) + " ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü";
            return "‡¶Ö‡¶≤‡ßç‡¶™ ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ï‡ßç‡¶∑‡¶£";
        }

        function toggleForm() { document.getElementById('add-form').classList.toggle('hidden'); }
        function toggleDarkMode() { 
            document.documentElement.classList.toggle('dark');
            const icon = document.getElementById('dark-icon');
            icon.className = document.documentElement.classList.contains('dark') ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
        }

        fetchData();
    </script>
</body>
</html>
