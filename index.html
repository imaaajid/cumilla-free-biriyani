<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cumilla Biriyani Tracker - Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs" type="module"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>

    <style>
        body { font-family: 'Hind Siliguri', sans-serif; transition: background-color 0.3s; }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .dark .glass { background: rgba(31, 41, 55, 0.9); border-color: rgba(75, 85, 99, 0.3); }
        .trending-glow { box-shadow: 0 0 25px rgba(234, 88, 12, 0.3); border: 2px solid #ea580c !important; }
        .stock-out { filter: grayscale(1); opacity: 0.5; pointer-events: none; }
        
        /* Preloader Animation */
        #preloader { position: fixed; inset: 0; background: white; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s; }
        .dark #preloader { background: #111827; }
    </style>
</head>
<body class="bg-orange-50 dark:bg-gray-900 dark:text-gray-100 pb-32">

    <div id="preloader">
        <dotlottie-player src="https://lottie.host/96580f1e-f32a-464a-9b21-4d3752e25528/8R5E12E9Qy.json" background="transparent" speed="1" style="width: 250px; height: 250px;" loop autoplay></dotlottie-player>
        <p class="text-orange-600 font-bold animate-bounce mt-4">‡¶¨‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶®‡¶ø ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>

    <div class="bg-stone-900 text-white py-3 px-4 flex justify-between items-center sticky top-0 z-[60] shadow-md">
        <div class="text-[10px] uppercase tracking-widest text-orange-500 font-bold" id="countdown">--:--:--</div>
        <button onclick="toggleDarkMode()" class="p-2 bg-gray-800 rounded-lg text-orange-400">
            <i id="dark-icon" class="fa-solid fa-moon"></i>
        </button>
    </div>

    <header class="bg-white/80 dark:bg-gray-800/80 border-b border-orange-100 dark:border-gray-700 py-6 px-4 text-center glass sticky top-[52px] z-50">
        <h1 class="text-2xl font-black text-orange-600 uppercase tracking-tighter">Cumilla Biriyani Tracker üçñ</h1>
        <div class="mt-2 inline-flex items-center gap-2 bg-orange-50 dark:bg-gray-700 text-orange-700 dark:text-orange-400 px-4 py-1.5 rounded-full text-[11px] font-bold">
            <span class="w-2 h-2 bg-green-500 rounded-full animate-ping"></span> ‡¶Ü‡¶ú‡¶ï‡ßá ‡¶è‡¶ï‡¶ü‡¶ø‡¶≠: <span id="count-num" class="mx-1">‡ß¶</span> ‡¶ü‡¶ø
        </div>
        <div class="max-w-md mx-auto mt-4 px-2">
            <input type="text" id="search-input" onkeyup="filterPosts()" placeholder="‡¶è‡¶≤‡¶æ‡¶ï‡¶æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." 
            class="w-full p-3 pl-10 rounded-2xl bg-gray-100 dark:bg-gray-700 border-none outline-none focus:ring-2 focus:ring-orange-500 transition-all dark:placeholder-gray-400">
        </div>
    </header>

    <main id="post-container" class="max-w-md mx-auto px-4 mt-8 space-y-6">
        </main>

    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 w-full max-w-md px-4 z-40">
        <button onclick="toggleForm()" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-black py-4 rounded-3xl shadow-2xl flex items-center justify-center gap-3 active:scale-95 transition-all">
            <i class="fa-solid fa-plus-circle"></i> ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
        </button>
    </div>

    <div id="add-form" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-end justify-center z-[100]">
        <div class="bg-white dark:bg-gray-800 w-full max-w-md p-8 rounded-t-[3rem] animate-fade-in shadow-2xl">
            <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶™‡¶ü üìù</h2>
            <input id="loc-name" type="text" placeholder="‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶®‡¶æ‡¶Æ" class="w-full p-4 bg-gray-100 dark:bg-gray-700 rounded-2xl mb-4 outline-none dark:text-white">
            <textarea id="loc-desc" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§..." class="w-full p-4 bg-gray-100 dark:bg-gray-700 rounded-2xl mb-6 outline-none h-24 dark:text-white"></textarea>
            <div class="flex gap-4">
                <button onclick="toggleForm()" class="flex-1 py-4 text-gray-400">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                <button onclick="saveData()" class="flex-[2] bg-orange-600 text-white py-4 rounded-2xl font-bold">‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂</button>
            </div>
        </div>
    </div>

    <audio id="clickSound" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>

    <script>
        const DB_URL = "https://cumilla-biriyani-default-rtdb.asia-southeast1.firebasedatabase.app/posts.json";
        let allPosts = [];

        // Dark Mode Logic
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            document.getElementById('dark-icon').className = isDark ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // Play Sound
        function playSound() { document.getElementById('clickSound').play(); }

        // Preloader Logic
        window.addEventListener('load', () => {
            setTimeout(() => { document.getElementById('preloader').style.opacity = '0'; 
            setTimeout(() => document.getElementById('preloader').style.display = 'none', 500); }, 2500);
        });

        // Countdown Logic
        setInterval(() => {
            const diff = new Date().setHours(18, 15, 0) - new Date();
            if (diff < 0) return;
            const h = Math.floor(diff/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000);
            document.getElementById('countdown').innerText = `‡¶á‡¶´‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ï‡¶ø: ${h}:${m}:${s}`;
        }, 1000);

        async function fetchData() {
            try {
                const res = await fetch(DB_URL);
                const data = await res.json();
                allPosts = data ? Object.keys(data).map(id => ({ id, ...data[id] })).reverse() : [];
                renderPosts(allPosts);
            } catch (err) { console.error(err); }
        }

        function renderPosts(posts) {
            const container = document.getElementById('post-container');
            container.innerHTML = "";
            let count = 0;
            posts.forEach(post => {
                if ((Date.now() - post.timestamp) > 86400000) return;
                count++;
                const isTrending = post.true_count >= 10;
                const isStockOut = post.stock_out_votes >= 5;
                
                container.innerHTML += `
                    <div class="bg-white dark:bg-gray-800 rounded-[2rem] p-6 shadow-sm border border-orange-50 dark:border-gray-700 relative transition-all ${isTrending ? 'trending-glow' : ''} ${isStockOut ? 'stock-out' : ''}">
                        ${isStockOut ? '<div class="absolute inset-0 flex items-center justify-center z-10"><span class="bg-red-600 text-white font-black px-4 py-1 rounded-lg rotate-[-15deg]">‡¶∂‡ßá‡¶∑!</span></div>' : ''}
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-[10px] text-gray-400 font-bold">${new Date(post.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                            <button onclick="sharePost('${post.location}')" class="text-orange-500"><i class="fa-solid fa-share"></i></button>
                        </div>
                        <h3 class="text-xl font-black mb-2">üìç ${post.location}</h3>
                        <p class="text-gray-500 dark:text-gray-400 text-sm mb-5">${post.description}</p>
                        <div class="flex gap-2 mb-4">
                            <button onclick="handleVote('${post.id}', 'true_count')" class="flex-1 py-2 bg-green-50 dark:bg-green-900/20 text-green-600 rounded-xl text-xs font-bold border border-green-100 dark:border-green-800">‚úÖ ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø (${post.true_count || 0})</button>
                            <button onclick="handleVote('${post.id}', 'fake_count')" class="flex-1 py-2 bg-red-50 dark:bg-red-900/20 text-red-600 rounded-xl text-xs font-bold border border-red-100 dark:border-red-800">‚ùå ‡¶≠‡ßÅ‡ßü‡¶æ (${post.fake_count || 0})</button>
                        </div>
                        <button onclick="handleVote('${post.id}', 'stock_out_votes')" class="w-full py-2 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-xl text-[10px] font-bold uppercase tracking-widest italic">‡¶¨‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∂‡ßá‡¶∑ ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡ßá?</button>
                    </div>
                `;
            });
            document.getElementById('count-num').innerText = count;
        }

        async function handleVote(id, type) {
            playSound();
            const post = allPosts.find(p => p.id === id);
            const update = {}; update[type] = (post[type] || 0) + 1;
            await fetch(DB_URL.replace('.json', `/${id}.json`), { method: 'PATCH', body: JSON.stringify(update) });
            fetchData();
        }

        async function saveData() {
            playSound();
            const location = document.getElementById('loc-name').value;
            const description = document.getElementById('loc-desc').value;
            if(!location || !description) return alert("‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®!");
            await fetch(DB_URL, { method: 'POST', body: JSON.stringify({ location, description, timestamp: Date.now(), true_count: 0, fake_count: 0, stock_out_votes: 0 }) });
            toggleForm(); fetchData();
        }

        function toggleForm() { document.getElementById('add-form').classList.toggle('hidden'); }
        function filterPosts() {
            const q = document.getElementById('search-input').value.toLowerCase();
            renderPosts(allPosts.filter(p => p.location.toLowerCase().includes(q)));
        }

        // Auto Load
        if(localStorage.getItem('theme') === 'dark') toggleDarkMode();
        fetchData();
    </script>
</body>
</html>
