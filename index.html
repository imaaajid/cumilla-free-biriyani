<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cumilla Free Biriyani - Search & Live</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .search-focus:focus { ring: 2px; ring-color: #ea580c; border-color: transparent; }
    </style>
</head>
<body class="bg-orange-50 pb-28 font-sans text-gray-900">

    <header class="bg-orange-600 text-white py-6 px-4 text-center shadow-lg sticky top-0 z-50">
        <h1 class="text-2xl font-black uppercase tracking-tighter">Cumilla Biriyani Tracker üçñ</h1>
        <div class="mt-2 inline-block bg-white text-orange-600 px-4 py-1 rounded-full text-xs font-bold shadow-inner">
            ‡¶Ü‡¶ú‡¶ï‡ßá ‡¶¨‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶®‡¶ø ‡¶¶‡¶ø‡¶ö‡ßç‡¶õ‡ßá: <span id="count-num">‡ß¶</span> ‡¶ü‡¶ø ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü
        </div>
        
        <div class="max-w-md mx-auto mt-4 relative px-2">
            <input type="text" id="search-input" onkeyup="filterPosts()" placeholder="‡¶è‡¶≤‡¶æ‡¶ï‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶® (‡¶â‡¶¶‡¶æ: ‡¶ï‡¶æ‡¶®‡ßç‡¶¶‡¶ø‡¶∞‡¶™‡¶æ‡ßú)..." 
            class="w-full p-3 pl-10 rounded-xl text-gray-800 text-sm outline-none shadow-md focus:ring-2 focus:ring-orange-300 transition-all">
            <i class="fa fa-search absolute left-5 top-3.5 text-gray-400"></i>
        </div>
    </header>

    <main id="post-container" class="max-w-md mx-auto px-4 mt-6">
        <div class="text-center py-10 text-gray-400 italic">‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
    </main>

    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 w-full max-w-md px-4 z-40">
        <button onclick="toggleForm()" class="w-full bg-black text-white font-bold py-4 rounded-2xl shadow-2xl flex items-center justify-center gap-2 border-2 border-gray-700 active:scale-95 transition">
            ‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
        </button>
    </div>

    <div id="add-form" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center p-6 z-[60]">
        <div class="bg-white w-full max-w-sm p-6 rounded-3xl shadow-2xl">
            <h2 class="text-xl font-bold mb-4">‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶®‡¶ø ‡¶∏‡ßç‡¶™‡¶ü</h2>
            <input id="loc-name" type="text" placeholder="‡¶è‡¶≤‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶â‡¶¶‡¶æ: ‡¶ï‡¶æ‡¶®‡ßç‡¶¶‡¶ø‡¶∞‡¶™‡¶æ‡ßú)" class="w-full p-3 border rounded-xl mb-3 outline-none focus:border-orange-500">
            <input id="map-link" type="text" placeholder="‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" class="w-full p-3 border rounded-xl mb-3 outline-none text-blue-600 text-sm">
            <textarea id="loc-desc" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶ö‡¶ø‡¶ï‡ßá‡¶® ‡¶¨‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶®‡¶ø, ‡ß®‡ß¶‡ß¶ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ü)" class="w-full p-3 border rounded-xl mb-4 outline-none focus:border-orange-500"></textarea>
            
            <div class="flex gap-2">
                <button onclick="toggleForm()" class="flex-1 bg-gray-100 py-3 rounded-xl font-bold">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                <button id="submit-btn" onclick="saveData()" class="flex-1 bg-orange-600 text-white py-3 rounded-xl font-bold">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü</button>
            </div>
        </div>
    </div>

    <script>
        const DB_URL = "https://cumilla-biriyani-default-rtdb.asia-southeast1.firebasedatabase.app/posts.json";
        let allPosts = []; // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡¶æ

        async function fetchData() {
            try {
                const res = await fetch(DB_URL);
                const data = await res.json();
                allPosts = data ? Object.keys(data).map(id => ({ id, ...data[id] })).reverse() : [];
                renderPosts(allPosts);
            } catch (err) { console.error(err); }
        }

        function renderPosts(posts) {
            const container = document.getElementById('post-container');
            const countNum = document.getElementById('count-num');
            container.innerHTML = "";
            
            const currentTime = Date.now();
            const TWENTY_FOUR_HOURS = 24 * 60 * 60 * 1000;
            let validCount = 0;

            posts.forEach(post => {
                // ‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞
                if (post.timestamp && (currentTime - post.timestamp) > TWENTY_FOUR_HOURS) return;

                validCount++;
                const finalMapUrl = post.map_link ? post.map_link : `https://www.google.com/maps/search/${encodeURIComponent(post.location + ' Cumilla')}`;
                
                container.innerHTML += `
                    <div class="bg-white rounded-3xl shadow-md p-6 border border-orange-100 mb-6 animate-fade-in post-card">
                        <div class="flex justify-between items-center mb-2">
                            <span class="bg-green-100 text-green-700 text-[10px] font-black px-3 py-1 rounded-full uppercase">Active</span>
                            <span class="text-[10px] text-gray-400 font-bold uppercase">${timeSince(post.timestamp)} ‡¶Ü‡¶ó‡ßá</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 location-name">üìç ${post.location}</h3>
                        <p class="text-gray-600 mt-2 text-sm leading-relaxed">${post.description}</p>
                        
                        <a href="${finalMapUrl}" target="_blank" class="mt-4 w-full bg-orange-50 text-orange-600 border border-orange-200 font-bold py-3 rounded-xl flex items-center justify-center gap-2 hover:bg-orange-600 hover:text-white transition">
                            <i class="fa-solid fa-diamond-turn-right"></i> ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                        </a>
                        
                        <div class="mt-4 flex gap-3 pt-4 border-t border-gray-100">
                            <button onclick="vote('${post.id}', 'true_count')" class="flex-1 py-2 bg-green-50 text-green-700 rounded-lg text-xs font-bold border border-green-100 active:scale-95 transition">‚úÖ ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø (${post.true_count || 0})</button>
                            <button onclick="vote('${post.id}', 'fake_count')" class="flex-1 py-2 bg-red-50 text-red-700 rounded-lg text-xs font-bold border border-red-100 active:scale-95 transition">‚ùå ‡¶≠‡ßÅ‡ßü‡¶æ (${post.fake_count || 0})</button>
                        </div>
                    </div>
                `;
            });
            countNum.innerText = validCount;
            if(validCount === 0) container.innerHTML = "<p class='text-center text-gray-400 py-10'>‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>";
        }

        // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function filterPosts() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const filtered = allPosts.filter(post => 
                post.location.toLowerCase().includes(query) || 
                post.description.toLowerCase().includes(query)
            );
            renderPosts(filtered);
        }

        async function saveData() {
            const location = document.getElementById('loc-name').value;
            const description = document.getElementById('loc-desc').value;
            const map_link = document.getElementById('map-link').value;
            const timestamp = Date.now();

            if(!location || !description) return alert("‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!");

            const btn = document.getElementById('submit-btn');
            btn.disabled = true; btn.innerText = "‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";

            try {
                await fetch(DB_URL, { method: 'POST', body: JSON.stringify({ location, description, map_link, timestamp, true_count: 0, fake_count: 0 }) });
                toggleForm();
                fetchData();
            } catch (err) { alert("‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); } 
            finally { btn.disabled = false; btn.innerText = "‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü"; }
        }

        async function vote(id, type) {
            const voteUrl = `https://cumilla-biriyani-default-rtdb.asia-southeast1.firebasedatabase.app/posts/${id}.json`;
            try {
                const res = await fetch(voteUrl);
                const post = await res.json();
                const update = {}; update[type] = (post[type] || 0) + 1;
                await fetch(voteUrl, { method: 'PATCH', body: JSON.stringify(update) });
                fetchData();
            } catch (err) { console.error(err); }
        }

        function timeSince(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            let interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + " ‡¶ò‡¶£‡ßç‡¶ü‡¶æ";
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü";
            return Math.floor(seconds) + " ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°";
        }

        function toggleForm() { 
            document.getElementById('add-form').classList.toggle('hidden'); 
            document.getElementById('loc-name').value = "";
            document.getElementById('loc-desc').value = "";
        }

        fetchData();
        setInterval(fetchData, 60000); // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ßß ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá ‡¶Ö‡¶ü‡ßã ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï
    </script>
</body>
</html>