<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cumilla Biriyani Tracker - Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #fffaf5; scroll-behavior: smooth; }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .trending-glow { box-shadow: 0 0 25px rgba(234, 88, 12, 0.3); border: 2px solid #ea580c !important; }
        .stock-out { filter: grayscale(1); opacity: 0.7; pointer-events: none; }
        .stock-label { transform: rotate(-15deg); }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .live-dot { width: 8px; height: 8px; background: #22c55e; border-radius: 50%; display: inline-block; animation: pulse 2s infinite; }
    </style>
</head>
<body class="pb-32">

    <div class="bg-stone-900 text-white py-3 px-4 text-center sticky top-0 z-[60] shadow-md border-b border-orange-900/50">
        <p class="text-[10px] uppercase tracking-widest opacity-70 mb-1">‡¶á‡¶´‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶Ü‡¶∞ ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞</p>
        <div id="countdown" class="text-xl font-black tracking-widest font-mono text-orange-500">-- : -- : --</div>
    </div>

    <header class="bg-white/80 border-b border-orange-100 py-6 px-4 text-center glass sticky top-[56px] z-50">
        <h1 class="text-2xl font-black text-orange-600 uppercase tracking-tighter">Cumilla Biriyani Tracker üçñ</h1>
        <div class="mt-2 inline-flex items-center gap-2 bg-orange-50 text-orange-700 px-4 py-1.5 rounded-full text-[11px] font-bold">
            <span class="live-dot"></span> ‡¶Ü‡¶ú‡¶ï‡ßá ‡¶è‡¶ï‡¶ü‡¶ø‡¶≠: <span id="count-num" class="mx-1 text-sm text-orange-600">‡ß¶</span> ‡¶ü‡¶ø ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü
        </div>
        
        <div class="max-w-md mx-auto mt-5 relative">
            <input type="text" id="search-input" onkeyup="filterPosts()" placeholder="‡¶è‡¶≤‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." 
            class="w-full p-4 pl-12 rounded-2xl bg-orange-50 border-none ring-2 ring-orange-100 focus:ring-orange-500 outline-none transition-all text-sm shadow-inner">
            <i class="fa fa-search absolute left-5 top-4.5 text-orange-300"></i>
        </div>
    </header>

    <main id="post-container" class="max-w-md mx-auto px-4 mt-8 space-y-8">
        <div class="text-center py-20 text-orange-200 animate-pulse font-bold">‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
    </main>

    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 w-full max-w-md px-4 z-40">
        <button onclick="toggleForm()" class="w-full bg-orange-600 text-white font-black py-5 rounded-[2rem] shadow-2xl flex items-center justify-center gap-3 active:scale-95 transition-all border-4 border-white">
            <i class="fa-solid fa-plus-circle text-xl"></i> ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
        </button>
    </div>

    <div id="add-form" class="hidden fixed inset-0 bg-black/70 backdrop-blur-md flex items-end justify-center z-[100]">
        <div class="bg-white w-full max-w-md p-8 rounded-t-[3rem] shadow-2xl animate-fade-in">
            <div class="w-16 h-1.5 bg-gray-200 mx-auto mb-6 rounded-full"></div>
            <h2 class="text-2xl font-black mb-6 text-gray-800">‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¶‡¶ø‡¶® üìù</h2>
            <input id="loc-name" type="text" placeholder="‡¶è‡¶≤‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶â‡¶¶‡¶æ: ‡¶ö‡¶ï‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞)" class="w-full p-4 bg-gray-50 rounded-2xl mb-4 outline-none focus:ring-2 focus:ring-orange-500 border-none shadow-sm font-bold">
            <input id="map-link" type="text" placeholder="‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï (‡¶Ö‡¶™‡¶∂‡¶®‡¶æ‡¶≤)" class="w-full p-4 bg-gray-50 rounded-2xl mb-4 outline-none text-blue-600 text-sm italic">
            <textarea id="loc-desc" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶ï‡¶§ ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ü, ‡¶ï‡¶ø ‡¶¨‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶®‡¶ø)..." class="w-full p-4 bg-gray-50 rounded-2xl mb-6 outline-none focus:ring-2 focus:ring-orange-500 h-28 shadow-sm"></textarea>
            
            <div class="flex gap-4">
                <button onclick="toggleForm()" class="flex-1 py-4 font-bold text-gray-400">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                <button id="submit-btn" onclick="saveData()" class="flex-[2] bg-orange-600 text-white py-4 rounded-2xl font-black shadow-lg shadow-orange-200">‡¶è‡¶ñ‡¶®‡¶á ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>
    </div>

    <script>
        const DB_URL = "https://cumilla-biriyani-default-rtdb.asia-southeast1.firebasedatabase.app/posts.json";
        let allPosts = [];

        // 1. Iftar Countdown Logic (Set for Cumilla Time)
        function updateCountdown() {
            const now = new Date();
            const iftarTime = new Date();
            iftarTime.setHours(18, 12, 0); // Approximate Iftar time
            if (now > iftarTime) iftarTime.setDate(iftarTime.getDate() + 1);
            const diff = iftarTime - now;
            const h = Math.floor(diff / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);
            document.getElementById('countdown').innerText = `${h.toString().padStart(2, '0')} : ${m.toString().padStart(2, '0')} : ${s.toString().padStart(2, '0')}`;
        }
        setInterval(updateCountdown, 1000);

        // 2. Fetch Data
        async function fetchData() {
            try {
                const res = await fetch(DB_URL);
                const data = await res.json();
                allPosts = data ? Object.keys(data).map(id => ({ id, ...data[id] })).reverse() : [];
                renderPosts(allPosts);
            } catch (err) { console.error(err); }
        }

        function renderPosts(posts) {
            const container = document.getElementById('post-container');
            const countNum = document.getElementById('count-num');
            container.innerHTML = "";
            let validCount = 0;
            const TWENTY_FOUR_HOURS = 24 * 60 * 60 * 1000;

            posts.forEach(post => {
                if (post.timestamp && (Date.now() - post.timestamp) > TWENTY_FOUR_HOURS) return;
                validCount++;
                
                const isTrending = (post.true_count || 0) >= 10;
                const isStockOut = (post.stock_out_votes || 0) >= 5;
                const mapUrl = post.map_link || `https://www.google.com/maps/search/${encodeURIComponent(post.location + ' Cumilla')}`;
                const shareText = `üìç ${post.location}\nüìù ${post.description}\nüó∫Ô∏è ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™: ${mapUrl}\n\n‡¶∏‡¶¨ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®: ${window.location.href}`;

                container.innerHTML += `
                    <div class="bg-white rounded-[2.5rem] p-7 border border-orange-50 shadow-sm relative transition-all ${isTrending ? 'trending-glow' : ''} ${isStockOut ? 'stock-out' : ''}">
                        
                        ${isStockOut ? '<div class="absolute inset-0 z-10 flex items-center justify-center"><span class="bg-red-600 text-white font-black px-6 py-2 rounded-lg text-2xl stock-label shadow-2xl border-4 border-white">‡¶∂‡ßá‡¶∑ ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡ßá!</span></div>' : ''}
                        
                        ${isTrending ? '<span class="absolute -top-3 left-8 bg-orange-600 text-white text-[10px] px-3 py-1.5 rounded-full font-black shadow-lg animate-bounce">üî• ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶™‡¶ü</span>' : ''}
                        
                        <div class="flex justify-between items-center mb-5">
                            <span class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">${timeSince(post.timestamp)} ‡¶Ü‡¶ó‡ßá</span>
                            <button onclick="shareOnWhatsApp('${shareText}')" class="text-orange-500 hover:text-orange-600 p-2 rounded-full bg-orange-50 transition">
                                <i class="fa-solid fa-share-nodes"></i>
                            </button>
                        </div>

                        <h3 class="text-2xl font-black text-gray-800 mb-3">üìç ${post.location}</h3>
                        <p class="text-gray-500 text-sm leading-relaxed mb-6 font-medium">${post.description}</p>

                        <div class="grid grid-cols-2 gap-3 mb-6">
                            <a href="${mapUrl}" target="_blank" class="flex items-center justify-center gap-2 py-4 bg-stone-900 text-white rounded-2xl font-bold text-xs shadow-lg active:scale-95 transition">
                                <i class="fa-solid fa-diamond-turn-right"></i> ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™
                            </a>
                            <button onclick="vote('${post.id}', 'stock_out_votes')" class="flex items-center justify-center gap-2 py-4 bg-red-50 text-red-600 rounded-2xl font-bold text-xs border border-red-100 hover:bg-red-100 transition">
                                <i class="fa-solid fa-box-archive"></i> ‡¶¨‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶®‡¶ø ‡¶∂‡ßá‡¶∑?
                            </button>
                        </div>

                        <div class="flex gap-3">
                            <button onclick="vote('${post.id}', 'true_count')" class="flex-1 py-3.5 bg-green-50 text-green-700 rounded-2xl text-[11px] font-black border border-green-100 active:scale-95 transition shadow-sm">‚úÖ ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø (${post.true_count || 0})</button>
                            <button onclick="vote('${post.id}', 'fake_count')" class="flex-1 py-3.5 bg-red-50 text-red-700 rounded-2xl text-[11px] font-black border border-red-100 active:scale-95 transition shadow-sm">‚ùå ‡¶≠‡ßÅ‡ßü‡¶æ (${post.fake_count || 0})</button>
                        </div>
                    </div>
                `;
            });
            countNum.innerText = validCount;
        }

        async function saveData() {
            const loc = document.getElementById('loc-name').value;
            const desc = document.getElementById('loc-desc').value;
            const map = document.getElementById('map-link').value;
            if(!loc || !desc) return alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!");
            
            const btn = document.getElementById('submit-btn');
            btn.innerText = "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            btn.disabled = true;

            await fetch(DB_URL, { method: 'POST', body: JSON.stringify({ 
                location: loc, 
                description: desc, 
                map_link: map, 
                timestamp: Date.now(), 
                true_count: 0, 
                fake_count: 0,
                stock_out_votes: 0
            }) });
            
            toggleForm(); 
            fetchData();
        }

        async function vote(id, type) {
            const res = await fetch(DB_URL.replace('.json', `/${id}.json`));
            const post = await res.json();
            const update = {}; 
            update[type] = (post[type] || 0) + 1;
            await fetch(DB_URL.replace('.json', `/${id}.json`), { method: 'PATCH', body: JSON.stringify(update) });
            fetchData();
        }

        function shareOnWhatsApp(text) {
            const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        function timeSince(d) {
            const s = Math.floor((Date.now() - d) / 1000);
            if (s / 3600 > 1) return Math.floor(s / 3600) + " ‡¶ò‡¶£‡ßç‡¶ü‡¶æ";
            if (s / 60 > 1) return Math.floor(s / 60) + " ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü";
            return "‡¶Ö‡¶≤‡ßç‡¶™ ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ï‡ßç‡¶∑‡¶£";
        }

        function filterPosts() {
            const q = document.getElementById('search-input').value.toLowerCase();
            renderPosts(allPosts.filter(p => p.location.toLowerCase().includes(q) || p.description.toLowerCase().includes(q)));
        }

        function toggleForm() { 
            document.getElementById('add-form').classList.toggle('hidden'); 
            document.getElementById('submit-btn').disabled = false;
            document.getElementById('submit-btn').innerText = "‡¶è‡¶ñ‡¶®‡¶á ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®";
        }

        fetchData();
        setInterval(fetchData, 45000);
    </script>
</body>
</html>
